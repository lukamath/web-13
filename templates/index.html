<!DOCTYPE html>
<html>
<head>
    <title>Word 13</title>
    <!-- Include flatpickr CSS and JavaScript -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">

    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/dogebutton.min.css') }}">


    <script>
        function validateInput() {
            var textArea = document.getElementById('input_text');
            var usernameField = document.getElementById('username');
            var charCount = textArea.value.length;
            var wordCount = textArea.value.trim().split(/\s+/).length;
            var errorDiv = document.getElementById('error_message');

            if (usernameField.value === "") {
                errorDiv.style.display = 'block'; // Show the error message
                errorDiv.innerHTML = "Please enter a username.";
                return false;
            } else if (wordCount > 10 || charCount > 109) {
                errorDiv.style.display = 'block'; // Show the error message
                errorDiv.innerHTML = "You've reached the limit of 10 words or 100 characters.";
                return false;
            } else {
                errorDiv.innerHTML = "";
            }
            return true;
        }

        function updateInput() {
            var textArea = document.getElementById('input_text');
            var charCount = textArea.value.length;
            var wordCount = textArea.value.trim().split(/\s+/).length;
            var errorDiv = document.getElementById('error_message');

            var words = textArea.value.split(' ');

            for (var i = 0; i < words.length; i++) {
                if (words[i].length > 10) {
                    alert("Word truncated to 10 characters: " + words[i].slice(0, 10));
                    words[i] = words[i].slice(0, 10);
                }
            }

            if (charCount > 100) {
                errorDiv.style.display = 'block'; // Show the error message
                errorDiv.innerHTML = "You've reached the limit of 100 characters.";
                textArea.value = textArea.value.slice(0, 100);
            } else {
                errorDiv.innerHTML = "";
            }

            textArea.value = words.join(' ');

            var wordsArray = textArea.value.trim().split(/\s+/);
            if (wordsArray.length > 10) {
                wordsArray = wordsArray.slice(0, 10);
                textArea.value = wordsArray.join(' ');
                errorDiv.style.display = 'block'; // Show the error message
                errorDiv.innerHTML = "You've reached the limit of 10 words.";
            } else {
                errorDiv.innerHTML = "";
            }

            var wordCountSpan = document.getElementById('word_count');
            wordCountSpan.innerHTML = wordsArray.length;

            var charCountSpan = document.getElementById('char_count');
            charCountSpan.innerHTML = charCount;
        }

        document.addEventListener('DOMContentLoaded', function () {
            flatpickr("#date_time", {  // Update the ID to match the input field
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                minuteIncrement: 10,
                minDate: "today",
                defaultDate: "today",
            });
            var usernameField = document.getElementById('username');
            usernameField.blur();
            var errorDiv = document.getElementById('error_message');
            errorDiv.style.display = 'none'; // Hide the error message initially

            flatpickr("#timepicker", {
            // Other configurations...

            // Disabling specific times on a specific date
            disable: [
                {
                    from: "2023-11-01 00:00",
                    to: "2023-11-01 00:01" // Disables just the 12:00 AM time slot
                }
            ]
});

        });

        function sendButtonClick() {
        var sendButton = document.getElementById('send-button');
        sendButton.click();
        return false; // Prevent the default action of the <a> tag
    }

    </script>
</head>
<body>
    <div class="message-box">
        <h1><img src="{{ url_for('static', filename='img/w13_mainlogo.png') }}" alt="word 13"></h1>
        <form method="POST" onsubmit="return validateInput();">
            <br>
            <div class="user-box">
                <label>Message</label>  
                <textarea id="input_text" name="input_text" rows="5" cols="40" oninput="updateInput();"></textarea>    
                <label>Signature</label>
                <input type="text" id="username" name="username">    
            </div>
            <div class="form-group">
                <label for="date_time">Date and Time:</label>
                <input type="text" id="date_time" name="date_time" class="form-control" required>
                <input type="submit" class="send-button" id="send-button" value="Send">
            </div>
            <div class="counter-box">
                <p>Character Count: <span id="char_count">0</span></p>
                <p>Word Count: <span id="word_count">0</span></p>
            </div>       
            <div class="btn-send">   
                <a href="#" onclick="return sendButtonClick();">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    Send
                </a>
            <p id="error_message" class="error-message">{{ error_message }}</p>
         </form>
    </div>
    <div class="bottom-box">
            <div data-xdgbtn-address="D6U7eTceRUace37ySXfAMgHtehMMNmiC7t" class="xdgbtn-donate xdgbtn-theme-corpo xdgbtn-black"></div>
            <script type="text/javascript" src="static/js/dogebutton.min.js"></script>
    </div>
</body>
</html>
